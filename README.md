# task5
task5 by alfabattle

Условие
Необходимо реализовать сервис актуализации стоимости корзины покупателя.
Суть актуализации стоимости корзины в расчете цен на товары с учетом различных промо-акций и получении итоговой суммы чека и размера скидки.
Сервис предполагается использовать сразу многими магазинами.

Сервис должен иметь REST API на http://IP:8084 с двумя методами:
/promo – в теле POST запроса приходит список дескрипторов актуальных промо-акции (содержит как акции Сети, так и акции для магазинов).
Этот метод вызывается каждый раз перед запуском тестов.
/receipt – метод для актуализации цен, на вход в теле POST запроса приходит id магазина, список покупаемых товаров и список предъявленных документов на скидки (например, карта лояльности), на выход ожидается список товаров с корректными ценами и названиями, размером скидки, сумма чека и суммарный размер скидки.

При тестировании система каждый раз последовательно вызывает эти два метода: сначала /promo, потом /receipt.

* IP - внешний IP виртуальной машины.
* Все ресурсы лежат тут: https://github.com/evgenyshiryaev/alfa-battle-resources/tree/master/task5
Входные данные	
CSV файлы с неизменяемыми данными:
items.csv - список продаваемых товаров (id, название, id товарной группы, базовая цена товара);
groups.csv - товарные группы (id, название);
Файл с описанием API – api.yml
Общие замечания
В каждом магазине действуют единые промо-акции сети, а также локальные промо-акции, приоритет которых выше.
Если для позиции в чеке может применяться сразу несколько промо-акций, то выбирается промо-акция с наиболее высоким приоритетом. 
Если для позиции чека подходят несколько промо-акций с одинаковым приоритетом, то нужно применять ту промо-акцию, которая даёт покупателю наибольшую скидку.

Округление следует проводить до 2 знаков с RoundingMode.HALF_EVEN.

!!! Автоматически будет проверяться только итоговая сумма чека и суммарная скидка, наличие и корректность позиций будет учитываться только на code review жюри !!!
Задачи
1. Без промо-акций
Пример:
Запрос: POST http://IP:8084/promo
{}
Ответ: 200
Запрос: POST http://IP:8084/receipt
{
  "shopId": 1,
  "loyaltyCard": false,
  "positions":
  [
    {
      "itemId": "3432166",
      "quantity": 1
    }
  ]
}
Ответ: 200
{
  "total": 141.99,
  "discount": 0.00,
  "positions":
  [
    {
      "id": "3432166",
      "name": "ЛУК.Жид.АНТИФ.G11 Green нез.1кг",
      "price": 141.99,
      "regularPrice": 141.99
    }
  ]
}


Следующая задача доступна после получения 8 баллов.
2. Промо-акция Карта Лояльности
В /promo может приходить список промо-акций типа “скидка при предъявлении карты лояльности” (LoyaltyCardRule). Акции могут быть как глобальные, так и для конкретных магазинов.
Скидка при предъявлении промо-акции должна применяться, если в запросе на подсчет корзины /receipt будет loyaltyCard=true и промо-акция может быть применена для магазина, id которого приходит в запросе подсчёта.

Пример:
Запрос: POST http://IP:8084/promo
{
  "loyaltyCardRules": 
  [
    {
      "shopId": -1,
      "discount": 0.03
    },
    {
      "shopId": 2,
      "discount": 0.05
    }
  ]
}
Ответ: 200
Запрос: POST http://IP:8084/receipt
{
  "shopId": 1,
  "loyaltyCard": false,
  "positions":
  [
    {
      "itemId": "3432166",
      "quantity": 1
    }
  ]
}
Ответ: 200
{
  "total": 137.73,
  "discount": 4.26,
  "positions":
  [
    {
      "id": "3432166",
      "name": "ЛУК.Жид.АНТИФ.G11 Green нез.1кг",
      "price": 137.73,
      "regularPrice": 141.99
    }
  ]
}



Следующая задача доступна после получения 16 баллов.
3. Промо-акция N+k
В /promo может приходить список промо-акций с типами LoyaltyCardRule и ItemCountRule. Акции могут быть как глобальные, так и для конкретных магазинов.
Суть скидки N+k в том, что при оплате N товаров заданного ID покупатель может получить k товаров бесплатно. Несколько примеров приведено ниже в таблице для Акции с N=3, k=2:

Кол-во товаров в чеке               Кол-во оплачиваемых товаров               Кол-во бесплатных товаров
        5                                     3                                           2
        4                                     3                                           1
        3                                     3                                           0
        2                                     2                                           0
        6                                     4                                           2
        8                                     6                                           2

Следующая задача доступна после получения 32 баллов.

4. Промо-акция Скидка на товарную группу
В /promo может приходить список промо-акций с типами LoyaltyCardRule, ItemCountRule, ItemGroupRule. 
Акции могут быть как глобальные, так и для конкретных магазинов.
Суть акции “Скидка на товарную группу” в том, что магазин предоставляет скидку заданного размера на все товары указанной товарной группы, если в чеке присутствуют более одного типа товара, входящих в группу.
